<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} &middot; {% endif %}{{ site.title }}</title>

  <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <link rel="canonical" href="{{ page.url | absolute_url }}">
  
  <!-- Open Graph -->
  <meta property="og:title" content="{% if page.title %}{{ page.title }} &middot; {% endif %}{{ site.title }}">
  <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:site_name" content="{{ site.title }}">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }} &middot; {% endif %}{{ site.title }}">
  <meta name="twitter:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">

  <!-- Preconnect to external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Signika:wght@400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ '/css/style.css' | relative_url }}">
  <link rel="icon" type="image/svg+xml" href="{{ '/favicon.svg' | relative_url }}">
  
  <!-- MathJax for LaTeX rendering -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
  
  <!-- Theme color for mobile browsers -->
  <meta name="theme-color" content="#3182ce">
  <meta name="msapplication-TileColor" content="#3182ce">
</head>
<body class="site-body {% if page.page_class %}{{ page.page_class }}{% endif %}">
  <a class="skip-link" href="#content">Skip to content</a>
  <header class="site-header" role="banner">
    <div class="container">
      <div class="site-brand">
        <a class="brand-name" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        {% assign tagline = site.brand_tagline | default: site.description %}
        {% if tagline %}
        <p class="brand-tagline">{{ tagline }}</p>
        {% endif %}
      </div>
      <div class="site-controls">
        {% if site.nav %}
        <nav class="site-nav" aria-label="Primary">
          <ul>
            {% for item in site.nav %}
              {% assign nav_url = item.url | relative_url %}
              {% assign is_active = false %}
              {% if page.url == nav_url %}
                {% assign is_active = true %}
              {% elsif page.collection == 'posts' and item.url == '/blog/' %}
                {% assign is_active = true %}
              {% endif %}
              <li>
                <a href="{{ nav_url }}"{% if is_active %} class="is-active" aria-current="page"{% endif %}>{{ item.title }}</a>
              </li>
            {% endfor %}
          </ul>
        </nav>
        {% endif %}
        <button type="button" class="theme-toggle" data-theme-toggle aria-label="Toggle color theme">
          <svg class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true" viewBox="0 0 24 24">
            <path d="M12 4.5a1 1 0 0 1-1-1V2a1 1 0 1 1 2 0v1.5a1 1 0 0 1-1 1Zm6.364 2.136a1 1 0 1 1 1.414-1.414l1.06 1.06a1 1 0 0 1-1.414 1.415l-1.06-1.061ZM21.5 11a1 1 0 0 1 0 2H20a1 1 0 1 1 0-2h1.5Zm-2.662 7.177 1.06 1.06a1 1 0 0 1-1.414 1.415l-1.06-1.061a1 1 0 0 1 1.414-1.414ZM12 19.5a1 1 0 0 1 1 1V22a1 1 0 1 1-2 0v-1.5a1 1 0 0 1 1-1Zm-7.177-2.662a1 1 0 0 1 1.414 1.414l-1.06 1.06a1 1 0 1 1-1.415-1.414l1.061-1.06ZM4.5 12a1 1 0 0 1-1-1V9.5a1 1 0 1 1 2 0V11a1 1 0 0 1-1 1Zm1.113-6.364-1.06-1.06A1 1 0 0 1 5.968 3.16l1.06 1.061A1 1 0 0 1 5.614 5.636ZM12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z"/>
          </svg>
          <svg class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true" viewBox="0 0 24 24">
            <path d="M21 14.5A9.5 9.5 0 0 1 9.5 3a.75.75 0 0 0-.59 1.216 7 7 0 1 0 11.874 7.212.75.75 0 0 0-.784-.928Z"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="content" class="site-content">
    <div class="container">
      {% if page.title and page.layout != 'post' and page.show_title != false %}
      <header class="page-header">
        <h1>{{ page.title }}</h1>
        {% if page.date %}
          <p class="page-meta">{{ page.date | date: '%B %d, %Y' }}{% if page.author %} &middot; {{ page.author }}{% endif %}</p>
        {% endif %}
      </header>
      {% endif %}

      {{ content }}
    </div>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <p>&copy; {{ site.time | date: '%Y' }} {{ site.title }}. Built with dedication to computational excellence.</p>
      <p>
        <a href="{{ '/blog/' | relative_url }}">Latest Writing</a> &middot; 
        <a href="{{ '/research/' | relative_url }}">Research</a> &middot; 
        <a href="{{ '/teaching/' | relative_url }}">Teaching</a> &middot; 
        <a href="{{ '/resume/' | relative_url }}">CV</a>
      </p>
    </div>
  </footer>

  <!-- Performance optimization -->
  <script>
    // Improve loading performance
    if ('requestIdleCallback' in window) {
      requestIdleCallback(function() {
        // Lazy load non-critical resources
        const links = document.querySelectorAll('a[href^="http"]');
        links.forEach(link => {
          if (!link.getAttribute('target')) {
            link.setAttribute('rel', 'noopener noreferrer');
          }
        });
      });
    }
  </script>
  <script>
    (function() {
      const storageKey = 'preferred-color-scheme';
      const root = document.documentElement;
      const toggle = document.querySelector('[data-theme-toggle]');

      if (!toggle) return;

      const getPreference = () => {
        const stored = localStorage.getItem(storageKey);
        if (stored === 'light' || stored === 'dark') {
          return stored;
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      };

      const applyPreference = (theme) => {
        root.setAttribute('data-theme', theme);
        toggle.setAttribute('aria-pressed', theme === 'dark');
      };

      applyPreference(getPreference());

      toggle.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        localStorage.setItem(storageKey, next);
        applyPreference(next);
      });

      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
        if (!localStorage.getItem(storageKey)) {
          applyPreference(event.matches ? 'dark' : 'light');
        }
      });
    })();
  </script>
</body>
</html>
